# MD-002 — Recordatorios de Reserva (RF-29)

## Resumen
Implementar configuración de recordatorios personalizables para reservas, permitiendo a usuarios definir intervalos y canales de notificación, con historial auditables.

## Skills a invocar
- `web-app`: Construcción de UI en profile y modal de reserva
- `backend`: Mock endpoints y lógica de recordatorios
- `seguridad-privacidad-compliance`: Validación de preferencias y consentimiento de notificaciones
- `qa-calidad`: Tests unitarios, E2E smoke y regression

## Qué construir

### 1. Sección "Configuración de Recordatorios" en `/profile`
- **Componente**: `ReminderSettings.tsx`
- **Contenido**:
  - Intervalos: 30 min, 1 hora, 24 horas (checkboxes)
  - Canales: email, WhatsApp (checkboxes)
  - Botón "Guardar Preferencias"
  - `data-testid="reminder-settings-section"`

### 2. Integración en flujo de reserva
- **Ubicación**: Modal `ReservationModal.tsx`
- **Contenido**: Opcional, checkbox "Configurar recordatorios para esta reserva"
- **Acción**: Al activar, abre mini-modal con preferencias rápidas

### 3. Historial de recordatorios (admin)
- **Ubicación**: Nueva sección en `/reportes/auditoria` o similar
- **Contenido**: Listado de recordatorios enviados con filtros
- **Permisos**: Solo admin

## Rutas nuevas
Ninguna ruta nueva. Se integra en páginas existentes.

## Archivos a crear/modificar

### Frontend Components
- `src/components/molecules/ReminderSettings.tsx` - Nuevo
- `src/components/atoms/ReminderCheckbox.tsx` - Nuevo
- `src/app/[locale]/profile/page.tsx` - Modificar (agregar tab)
- `src/components/organisms/ReservationModal.tsx` - Modificar (agregar opción)

### Data y Mock
- `src/infrastructure/mock/data/reminders.mock.ts` - Nuevo
- `src/infrastructure/mock/mockService.ts` - Modificar (agregar endpoints)

### Tipos y Hooks
- `src/types/entities/reminder.ts` - Nuevo
- `src/hooks/useReminders.ts` - Nuevo

### Internacionalización
- `src/i18n/translations/es/reminders.json` - Nuevo
- `src/i18n/translations/en/reminders.json` - Nuevo
- `src/i18n/request.ts` - Modificar (agregar namespace)

## Mock Data Structure
```typescript
interface ReminderPreferences {
  id: string;
  userId: string;
  intervals: number[]; // [30, 60, 1440] minutos
  channels: string[]; // ['email', 'whatsapp']
  enabled: boolean;
  createdAt: Date;
  updatedAt: Date;
}

interface ReminderHistory {
  id: string;
  reservationId: string;
  userId: string;
  sentAt: Date;
  channel: string;
  interval: number;
  status: 'sent' | 'failed';
}
```

## Mock Endpoints
```typescript
// GET /api/user/reminders/preferences
// PUT /api/user/reminders/preferences
// GET /api/admin/reminders/history?userId=&from=&to=
```

## Tests

### Unit Tests
- `ReminderSettings` component test
- Validación de preferencias
- Form submission

### E2E Tests
- **Smoke**: Verificar sección visible en profile
  - `data-testid="reminder-settings-section"`
- **Regression**: Configurar intervalos, guardar, verificar persistencia
- **Regression**: Verificar historial de recordatorios (admin)

## Criterios de Aceptancia
- [ ] Usuario puede configurar intervalos y canales
- [ ] Preferencias se persisten correctamente
- [ ] Las notificaciones se envían según configuración
- [ ] Admin puede ver historial completo
- [ ] UI es responsive y accesible
- [ ] Todos los tests pasan

## Dependencias
- `react-hook-form` para validación
- `recharts` opcional para estadísticas en historial
- Mock service existente

## Riesgos y Consideraciones
- Validar límites de frecuencia para evitar spam
- Consentimiento explícito para WhatsApp
- Manejo de errores en envío de notificaciones
